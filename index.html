<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NantawatLoan - ‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏ß</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <!-- Custom Styles & Animations -->
    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #020617; /* Slate 950 */
            color: #e2e8f0;
        }
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a; 
        }
        ::-webkit-scrollbar-thumb {
            background: #334155; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; 
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        .animate-slide-up {
            animation: slideUp 0.7s ease-out forwards;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body class="selection:bg-cyan-500 selection:text-black">

    <!-- ================= LOADING SCREEN ================= -->
    <div id="loading-screen" class="fixed inset-0 z-[100] bg-slate-950 flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="relative w-24 h-24 mb-8">
            <div class="absolute inset-0 border-4 border-slate-800 rounded-full"></div>
            <div class="absolute inset-0 border-t-4 border-cyan-500 rounded-full animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center">
                <i data-lucide="zap" class="h-10 w-10 text-cyan-500 animate-pulse"></i>
            </div>
        </div>
        <h2 class="text-2xl font-bold text-white tracking-[0.2em] animate-pulse">LOADING SYSTEM</h2>
        <div class="flex items-center space-x-2 mt-4 text-cyan-500 font-mono text-xs">
            <i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i>
            <span>ESTABLISHING SECURE CONNECTION...</span>
        </div>
    </div>

    <!-- ================= TOP BAR (NEW) ================= -->
    <div class="bg-slate-950 border-b border-slate-800 text-slate-400 text-xs py-2 relative z-[49]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <div class="flex items-center space-x-4 sm:space-x-6">
                <span class="flex items-center hover:text-cyan-400 cursor-pointer transition-colors">
                    <i data-lucide="phone" class="w-3 h-3 mr-2"></i> 02-123-4567
                </span>
                <span class="hidden sm:flex items-center hover:text-cyan-400 cursor-pointer transition-colors">
                    <i data-lucide="mail" class="w-3 h-3 mr-2"></i> contact@nantawatloan.com
                </span>
            </div>
            <div class="flex items-center space-x-4">
                <span class="flex items-center text-cyan-500 font-medium">
                    <i data-lucide="clock" class="w-3 h-3 mr-2"></i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô 08:00 - 22:00
                </span>
                <div class="h-3 w-px bg-slate-700 hidden sm:block"></div>
                <div class="hidden sm:flex items-center space-x-3">
                    <a href="#" class="hover:text-white transition-colors flex items-center"><i data-lucide="facebook" class="w-3 h-3 mr-1"></i> FB</a>
                    <a href="#" class="hover:text-white transition-colors flex items-center text-green-400"><i data-lucide="message-circle" class="w-3 h-3 mr-1"></i> Line</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ================= NAVBAR ================= -->
    <nav class="bg-slate-900/95 backdrop-blur-md border-b border-cyan-900/50 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center cursor-pointer group" onclick="app.router('home')">
                    <div class="bg-gradient-to-r from-cyan-600 to-blue-600 p-2 rounded-lg mr-2 shadow-[0_0_15px_rgba(8,145,178,0.5)] group-hover:shadow-[0_0_25px_rgba(8,145,178,0.8)] transition-all">
                        <i data-lucide="zap" class="h-6 w-6 text-white"></i>
                    </div>
                    <span class="font-bold text-xl text-white tracking-wider">Nantawat<span class="text-cyan-400">Loan</span></span>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-8">
                    <button onclick="app.router('home')" class="text-slate-400 hover:text-cyan-400 font-medium tracking-wide transition-colors" id="nav-home">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                    <button onclick="app.openModal('products')" class="text-slate-400 hover:text-cyan-400 font-medium tracking-wide transition-colors">‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå</button>
                    <button onclick="app.openModal('help')" class="text-slate-400 hover:text-cyan-400 font-medium tracking-wide transition-colors">‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</button>
                    
                    <!-- Dynamic Auth Button -->
                    <div id="auth-button-container">
                        <!-- Will be populated by JS -->
                    </div>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden flex items-center">
                    <button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="text-cyan-400 hover:text-white">
                        <i data-lucide="menu" class="h-6 w-6"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-slate-900 border-b border-cyan-900/50 p-4 space-y-3 shadow-xl absolute w-full">
            <button onclick="app.router('home'); document.getElementById('mobile-menu').classList.add('hidden')" class="block w-full text-left py-2 font-medium text-slate-300">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            <button onclick="app.openModal('products'); document.getElementById('mobile-menu').classList.add('hidden')" class="block w-full text-left py-2 font-medium text-slate-300">‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå</button>
            <button onclick="app.openModal('help'); document.getElementById('mobile-menu').classList.add('hidden')" class="block w-full text-left py-2 font-medium text-slate-300">‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</button>
            <div id="mobile-auth-btn-container"></div>
        </div>
    </nav>

    <!-- ================= VIEWS CONTAINER ================= -->
    <main id="app-container">
        
        <!-- VIEW: HOME -->
        <div id="view-home" class="view-section">
            <div class="bg-slate-950 relative overflow-hidden pb-16 pt-10 min-h-[90vh] flex flex-col justify-center">
                <!-- Background Effects -->
                <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
                    <div class="absolute -top-20 -right-20 w-96 h-96 bg-cyan-600/10 rounded-full blur-3xl"></div>
                    <div class="absolute top-40 -left-20 w-72 h-72 bg-purple-600/10 rounded-full blur-3xl"></div>
                    <div class="absolute bottom-0 left-1/2 w-full h-1 bg-gradient-to-r from-transparent via-cyan-500 to-transparent opacity-50"></div>
                </div>

                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
                        <!-- Left Content -->
                        <div class="animate-slide-up">
                            <div class="inline-flex items-center px-4 py-1 rounded-sm border border-cyan-500/30 bg-cyan-950/30 text-cyan-400 text-xs font-bold tracking-[0.2em] uppercase mb-6 backdrop-blur-sm">
                                <span class="w-2 h-2 rounded-full bg-green-400 mr-2 animate-pulse"></span>
                                ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (Live System)
                            </div>
                            <h1 class="text-5xl md:text-7xl font-extrabold text-white leading-tight mb-6 tracking-tight">
                                ‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏• <br/>
                                <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-500 drop-shadow-[0_0_10px_rgba(34,211,238,0.5)]">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏£‡∏¥‡∏á ‡∏î‡πâ‡∏ß‡∏¢ AI</span>
                            </h1>
                            <p class="text-lg text-slate-400 mb-8 border-l-4 border-cyan-600 pl-4">
                                ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß
                            </p>
                            <button onclick="app.router('apply')" class="flex justify-center items-center bg-cyan-600 text-white px-8 py-4 rounded-sm font-bold text-lg hover:bg-cyan-500 transition shadow-[0_0_20px_rgba(6,182,212,0.4)] uppercase tracking-wider">
                                <span class="flex items-center">‡∏¢‡∏∑‡πà‡∏ô‡∏Å‡∏π‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ <i data-lucide="chevron-right" class="ml-2 h-5 w-5"></i></span>
                            </button>
                        </div>

                        <!-- Right Content (Calculator) -->
                        <div class="bg-slate-900/90 backdrop-blur-xl rounded-lg border border-slate-700 p-8 shadow-2xl relative animate-slide-up" style="animation-delay: 0.2s;">
                            <h3 class="text-2xl font-bold text-white mb-8 flex items-center tracking-wide">
                                <i data-lucide="calculator" class="mr-3 text-cyan-400"></i> ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠
                            </h3>
                            
                            <div class="space-y-8">
                                <!-- Loan Amount Slider -->
                                <div>
                                    <div class="flex justify-between mb-3">
                                        <label class="text-slate-400 font-medium text-xs uppercase tracking-widest">‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</label>
                                        <span id="display-amount" class="text-cyan-400 font-bold text-xl font-mono">‡∏ø2,000</span>
                                    </div>
                                    <input type="range" id="input-amount" min="2000" max="500000" step="1000" value="2000"
                                        class="w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-cyan-500"
                                        oninput="app.updateCalculator()">
                                </div>

                                <!-- Weeks Slider -->
                                <div>
                                    <div class="flex justify-between mb-3">
                                        <label class="text-slate-400 font-medium text-xs uppercase tracking-widest">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞</label>
                                        <span id="display-weeks" class="text-purple-400 font-bold text-xl font-mono">4 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</span>
                                    </div>
                                    <input type="range" id="input-weeks" min="2" max="52" step="1" value="4"
                                        class="w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-purple-500"
                                        oninput="app.updateCalculator()">
                                </div>

                                <!-- Result Box -->
                                <div class="bg-slate-950/80 border border-slate-800 rounded-lg p-6 mt-4">
                                    <p class="text-slate-400 text-xs mb-1 uppercase tracking-wider">‡∏¢‡∏≠‡∏î‡∏ú‡πà‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</p>
                                    <p id="display-payment" class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-600 font-mono tracking-tight">
                                        ‡∏ø508
                                    </p>
                                </div>

                                <button onclick="app.router('apply')" class="w-full bg-slate-800 text-white py-4 rounded-sm font-bold text-lg hover:bg-slate-700 transition uppercase tracking-wider border border-slate-600">
                                    ‡πÉ‡∏ä‡πâ‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏µ‡πâ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features Section -->
            <div class="py-20 bg-slate-900 border-t border-slate-800">
                <div class="max-w-7xl mx-auto px-4 grid md:grid-cols-3 gap-8">
                    <!-- Feature 1 -->
                    <div class="p-6 bg-slate-950 rounded border border-slate-800 hover:border-cyan-500/50 transition group">
                        <i data-lucide="shield-check" class="w-10 h-10 text-cyan-500 mb-4 group-hover:scale-110 transition-transform"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Database ‡∏à‡∏£‡∏¥‡∏á</h3>
                        <p class="text-slate-400 text-sm">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô Cloud Firestore ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
                    </div>
                    <!-- Feature 2 -->
                    <div class="p-6 bg-slate-950 rounded border border-slate-800 hover:border-cyan-500/50 transition group">
                        <i data-lucide="lock" class="w-10 h-10 text-cyan-500 mb-4 group-hover:scale-110 transition-transform"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Auth ‡∏à‡∏£‡∏¥‡∏á</h3>
                        <p class="text-slate-400 text-sm">‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÅ‡∏ö‡∏ö Anonymous User ‡∏ú‡πà‡∏≤‡∏ô Firebase Auth</p>
                    </div>
                    <!-- Feature 3 -->
                    <div class="p-6 bg-slate-950 rounded border border-slate-800 hover:border-cyan-500/50 transition group">
                        <i data-lucide="cpu" class="w-10 h-10 text-cyan-500 mb-4 group-hover:scale-110 transition-transform"></i>
                        <h3 class="text-xl font-bold text-white mb-2">Logic ‡∏à‡∏£‡∏¥‡∏á</h3>
                        <p class="text-slate-400 text-sm">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: APPLY FORM -->
        <div id="view-apply" class="view-section hidden bg-slate-950 min-h-screen py-12 relative">
            <div class="max-w-2xl mx-auto px-4 relative z-10 animate-fade-in">
                <button onclick="app.router('home')" class="mb-6 text-slate-500 hover:text-cyan-400 flex items-center transition-colors font-mono text-sm">
                    &lt; ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                </button>
                
                <div class="bg-slate-900 rounded-lg border border-slate-700 shadow-2xl overflow-hidden">
                    <div class="bg-gradient-to-r from-slate-900 to-slate-800 p-6 border-b border-slate-700 flex justify-between items-center">
                        <div>
                            <h2 class="text-2xl font-bold text-white flex items-center tracking-wide">
                                <i data-lucide="file-text" class="mr-3 text-cyan-400"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£
                            </h2>
                            <p class="text-slate-400 text-xs mt-1 uppercase tracking-widest font-mono">:: Secure Connection ::</p>
                        </div>
                        <i data-lucide="lock" class="text-green-500 w-5 h-5"></i>
                    </div>
                    
                    <form id="apply-form" onsubmit="app.handleApply(event)" class="p-8 space-y-8">
                        <div class="space-y-4">
                            <h3 class="text-sm font-bold text-cyan-500 uppercase tracking-widest border-b border-slate-700 pb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="col-span-2 sm:col-span-1">
                                    <label class="block text-xs font-medium text-slate-400 mb-2 uppercase">‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô</label>
                                    <div id="form-display-amount" class="bg-slate-950 border border-slate-700 p-3 rounded text-white font-mono font-bold">‡∏ø0</div>
                                </div>
                                <div class="col-span-2 sm:col-span-1">
                                    <label class="block text-xs font-medium text-slate-400 mb-2 uppercase">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤</label>
                                    <div id="form-display-weeks" class="bg-slate-950 border border-slate-700 p-3 rounded text-white font-mono font-bold">0 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <h3 class="text-sm font-bold text-cyan-500 uppercase tracking-widest border-b border-slate-700 pb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏Å‡∏π‡πâ</h3>
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-2 uppercase">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                <input name="fullName" required type="text" class="w-full p-3 bg-slate-800 border border-slate-600 rounded text-white outline-none focus:border-cyan-500 transition-all font-mono">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-slate-400 mb-2 uppercase">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</label>
                                <input name="idCard" required type="text" maxlength="13" class="w-full p-3 bg-slate-800 border border-slate-600 rounded text-white outline-none focus:border-cyan-500 transition-all font-mono">
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-medium text-slate-400 mb-2 uppercase">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                    <input name="phone" required type="tel" class="w-full p-3 bg-slate-800 border border-slate-600 rounded text-white outline-none focus:border-cyan-500 transition-all font-mono">
                                </div>
                                <div>
                                    <label class="block text-xs font-medium text-slate-400 mb-2 uppercase">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
                                    <input name="salary" required type="number" class="w-full p-3 bg-slate-800 border border-slate-600 rounded text-white outline-none focus:border-cyan-500 transition-all font-mono">
                                </div>
                            </div>
                        </div>

                        <button type="submit" id="btn-submit" class="w-full bg-cyan-600 text-white py-4 rounded font-bold text-lg hover:bg-cyan-500 transition uppercase tracking-wider disabled:opacity-50 disabled:cursor-not-allowed">
                            ‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£
                        </button>
                        <p class="text-center text-[10px] text-slate-600 font-mono">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Firestore ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</p>
                    </form>
                </div>
            </div>
        </div>

        <!-- VIEW: DASHBOARD -->
        <div id="view-dashboard" class="view-section hidden bg-slate-950 min-h-screen py-10 relative overflow-hidden">
            <div class="max-w-4xl mx-auto px-4 relative z-10 animate-fade-in">
                <h2 class="text-2xl font-bold text-white mb-6 uppercase tracking-wider flex items-center">
                    <span class="w-1 h-8 bg-cyan-500 mr-4"></span>
                    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ
                </h2>

                <div id="dashboard-content">
                    <!-- Content will be injected by JS -->
                </div>
            </div>
        </div>

    </main>

    <!-- ================= FOOTER ================= -->
    <footer class="bg-slate-950 border-t border-slate-900 pt-16 pb-8 relative z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-12">
                
                <!-- Company Info -->
                <div>
                    <div class="flex items-center mb-4">
                        <div class="bg-gradient-to-r from-cyan-600 to-blue-600 p-1.5 rounded-lg mr-2">
                            <i data-lucide="zap" class="h-5 w-5 text-white"></i>
                        </div>
                        <span class="font-bold text-lg text-white tracking-wider">Nantawat<span class="text-cyan-400">Loan</span></span>
                    </div>
                    <p class="text-slate-500 text-sm leading-relaxed mb-6">
                        ‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏ß‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏ó‡∏µ‡πà‡∏ó‡∏±‡∏ô‡∏™‡∏°‡∏±‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á
                    </p>
                    <div class="flex space-x-3">
                        <a href="#" class="w-8 h-8 rounded bg-slate-900 border border-slate-800 flex items-center justify-center text-slate-400 hover:text-cyan-400 hover:border-cyan-500/50 transition-all">
                            <i data-lucide="facebook" class="w-4 h-4"></i>
                        </a>
                        <a href="#" class="w-8 h-8 rounded bg-slate-900 border border-slate-800 flex items-center justify-center text-slate-400 hover:text-green-400 hover:border-green-500/50 transition-all">
                            <i data-lucide="message-circle" class="w-4 h-4"></i>
                        </a>
                        <a href="#" class="w-8 h-8 rounded bg-slate-900 border border-slate-800 flex items-center justify-center text-slate-400 hover:text-pink-400 hover:border-pink-500/50 transition-all">
                            <i data-lucide="instagram" class="w-4 h-4"></i>
                        </a>
                    </div>
                </div>

                <!-- Quick Links -->
                <div>
                    <h4 class="text-sm font-bold text-white uppercase tracking-widest mb-6 border-l-2 border-cyan-500 pl-3">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</h4>
                    <ul class="space-y-3 text-sm text-slate-400">
                        <li><button onclick="app.router('home')" class="hover:text-cyan-400 transition flex items-center"><i data-lucide="chevron-right" class="w-3 h-3 mr-2 text-slate-600"></i> ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</button></li>
                        <li><button onclick="app.openModal('products')" class="hover:text-cyan-400 transition flex items-center"><i data-lucide="chevron-right" class="w-3 h-3 mr-2 text-slate-600"></i> ‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</button></li>
                        <li><button onclick="app.openModal('help')" class="hover:text-cyan-400 transition flex items-center"><i data-lucide="chevron-right" class="w-3 h-3 mr-2 text-slate-600"></i> ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</button></li>
                        <li><button onclick="app.router('apply')" class="hover:text-cyan-400 transition flex items-center"><i data-lucide="chevron-right" class="w-3 h-3 mr-2 text-slate-600"></i> ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠</button></li>
                    </ul>
                </div>

                <!-- Contact Info -->
                <div>
                    <h4 class="text-sm font-bold text-white uppercase tracking-widest mb-6 border-l-2 border-cyan-500 pl-3">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</h4>
                    <ul class="space-y-4 text-sm text-slate-400">
                        <li class="flex items-start">
                            <i data-lucide="map-pin" class="w-5 h-5 text-cyan-500 mr-3 mt-0.5 shrink-0"></i>
                            <span>123 ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ô‡∏±‡∏ô‡∏ó‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏ó‡∏≤‡∏ß‡πÄ‡∏ß‡∏≠‡∏£‡πå ‡∏ä‡∏±‡πâ‡∏ô 15 <br>‡∏ñ‡∏ô‡∏ô‡∏£‡∏±‡∏ä‡∏î‡∏≤‡∏†‡∏¥‡πÄ‡∏©‡∏Å ‡πÄ‡∏Ç‡∏ï‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏á <br>‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£ 10400</span>
                        </li>
                        <li class="flex items-center">
                            <i data-lucide="phone" class="w-5 h-5 text-cyan-500 mr-3 shrink-0"></i>
                            <span class="font-mono">02-123-4567</span>
                        </li>
                        <li class="flex items-center">
                            <i data-lucide="mail" class="w-5 h-5 text-cyan-500 mr-3 shrink-0"></i>
                            <a href="mailto:contact@nantawatloan.com" class="hover:text-white transition">contact@nantawatloan.com</a>
                        </li>
                    </ul>
                </div>

                <!-- Hours -->
                <div>
                    <h4 class="text-sm font-bold text-white uppercase tracking-widest mb-6 border-l-2 border-cyan-500 pl-3">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</h4>
                    <div class="bg-slate-900 p-4 rounded border border-slate-800">
                        <ul class="space-y-3 text-sm text-slate-400">
                            <li class="flex justify-between">
                                <span>‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå - ‡∏®‡∏∏‡∏Å‡∏£‡πå</span>
                                <span class="text-white font-mono">08:00 - 20:00</span>
                            </li>
                            <li class="flex justify-between">
                                <span>‡πÄ‡∏™‡∏≤‡∏£‡πå - ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</span>
                                <span class="text-white font-mono">09:00 - 18:00</span>
                            </li>
                            <li class="pt-2 border-t border-slate-800 mt-2 text-xs text-center text-cyan-500 flex items-center justify-center">
                                <i data-lucide="check-circle" class="w-3 h-3 mr-1"></i> ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå 24 ‡∏ä‡∏°.
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Divider -->
            <div class="border-t border-slate-900 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-slate-600">
                <p>&copy; 2024 NantawatLoan. ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå.</p>
                <div class="flex space-x-6 mt-4 md:mt-0">
                    <a href="#" class="hover:text-slate-400">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</a>
                    <a href="#" class="hover:text-slate-400">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</a>
                    <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="hover:text-cyan-400 flex items-center">
                        ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô <i data-lucide="arrow-up" class="ml-1 w-3 h-3"></i>
                    </button>
                </div>
            </div>
        </div>
    </footer>

    <!-- ================= MODALS ================= -->
    <div id="modal-overlay" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="app.closeModal()"></div>
        <div class="relative bg-slate-900 border border-cyan-500/30 rounded-lg shadow-2xl w-full max-w-md p-6 animate-fade-in">
            <button onclick="app.closeModal()" class="absolute top-4 right-4 text-slate-400 hover:text-white">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <div class="flex items-center mb-4 text-cyan-400">
                <div id="modal-icon" class="mr-2"></div>
                <h3 id="modal-title" class="text-xl font-bold uppercase tracking-wide">TITLE</h3>
            </div>
            <div id="modal-content" class="text-slate-300 max-h-[60vh] overflow-y-auto pr-2">
                <!-- Content -->
            </div>
        </div>
    </div>

    <!-- ================= JAVASCRIPT ================= -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, query, orderBy, limit, onSnapshot, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // --- Configuration ---
        // Load config safely. If undefined, default to empty object.
        let firebaseConfig = {};
        try {
            firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        } catch (e) {
            console.warn("Using empty config");
        }
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        // Initialize Firebase variables
        let firebaseApp, auth, db;
        
        // Check if we have a valid config (basic check)
        const isConfigValid = firebaseConfig && firebaseConfig.apiKey;

        if (isConfigValid) {
            try {
                firebaseApp = initializeApp(firebaseConfig);
                auth = getAuth(firebaseApp);
                db = getFirestore(firebaseApp);
            } catch (err) {
                console.error("Firebase Init Failed:", err);
            }
        } else {
            console.log("Running in Demo/Offline Mode (No Firebase Config)");
        }

        // --- Application State ---
        const state = {
            user: null,
            applicationData: null,
            loanAmount: 2000,
            loanWeeks: 4,
            weeklyPayment: 0,
            currentView: 'home'
        };

        // --- Helpers ---
        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('th-TH', { style: 'currency', currency: 'THB', maximumFractionDigits: 0 }).format(amount);
        };

        // --- Core Application Logic (Global 'app' Object) ---
        window.app = {
            init: async () => {
                // Ensure loading screen hides regardless of errors
                setTimeout(() => {
                    const loader = document.getElementById('loading-screen');
                    if (loader) {
                        loader.classList.add('opacity-0');
                        setTimeout(() => loader.classList.add('hidden'), 500);
                    }
                }, 2000);

                // Initialize Lucide Icons
                lucide.createIcons();
                app.updateCalculator();

                if (auth) {
                    // Real Auth Logic
                    const initialToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                    if (initialToken) {
                        await signInWithCustomToken(auth, initialToken);
                    } else {
                        await signInAnonymously(auth);
                    }

                    onAuthStateChanged(auth, (user) => {
                        state.user = user;
                        app.renderAuthButtons();
                        if (user) {
                            app.listenToApplications(user.uid);
                        }
                    });
                } else {
                    // Demo Mode Logic
                    console.log("Auth not initialized - UI Only Mode");
                    // Mock a user
                    state.user = { uid: 'demo-user', isAnonymous: true };
                    app.renderAuthButtons();
                }
            },

            // Firestore Real-time Listener
            listenToApplications: (uid) => {
                if (!db) return; // Guard for demo mode
                const q = query(
                    collection(db, 'artifacts', appId, 'users', uid, 'applications'),
                    orderBy('createdAt', 'desc'),
                    limit(1)
                );

                onSnapshot(q, (snapshot) => {
                    if (!snapshot.empty) {
                        state.applicationData = snapshot.docs[0].data();
                        // Convert Timestamp to Date
                        if(state.applicationData.createdAt && state.applicationData.createdAt.toDate) {
                            state.applicationData.createdAtDate = state.applicationData.createdAt.toDate();
                        }
                    } else {
                        state.applicationData = null;
                    }
                    app.renderAuthButtons();
                    if (state.currentView === 'dashboard') {
                        app.renderDashboard();
                    }
                }, (error) => {
                    console.error("Error fetching data:", error);
                });
            },

            // Navigation Router
            router: (viewName) => {
                if (viewName === state.currentView) return;
                
                // Show Global Loading briefly
                document.getElementById('loading-screen').classList.remove('hidden', 'opacity-0');
                
                setTimeout(() => {
                    // Hide all views
                    document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
                    
                    // Show target view
                    document.getElementById(`view-${viewName}`).classList.remove('hidden');
                    state.currentView = viewName;
                    
                    // Specific View Logic
                    if (viewName === 'apply') app.updateApplyForm();
                    if (viewName === 'dashboard') app.renderDashboard();

                    // Hide Loading
                    window.scrollTo(0, 0);
                    document.getElementById('loading-screen').classList.add('opacity-0');
                    setTimeout(() => document.getElementById('loading-screen').classList.add('hidden'), 500);

                    // Re-render nav styles
                    app.renderAuthButtons();
                }, 800);
            },

            // Loan Calculator Logic
            updateCalculator: () => {
                const amount = parseInt(document.getElementById('input-amount').value);
                const weeks = parseInt(document.getElementById('input-weeks').value);
                
                state.loanAmount = amount;
                state.loanWeeks = weeks;

                const interestRate = 0.15;
                const totalInterest = amount * interestRate * (weeks / 52);
                const totalPay = amount + totalInterest;
                const weekly = Math.ceil(totalPay / weeks);
                state.weeklyPayment = weekly;

                // Update DOM
                document.getElementById('display-amount').textContent = formatCurrency(amount);
                document.getElementById('display-weeks').textContent = `${weeks} ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå`;
                document.getElementById('display-payment').textContent = formatCurrency(weekly);
            },

            updateApplyForm: () => {
                document.getElementById('form-display-amount').textContent = formatCurrency(state.loanAmount);
                document.getElementById('form-display-weeks').textContent = `${state.loanWeeks} ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå`;
            },

            // --- Notification Function (DISCORD WEBHOOK) ---
            notifyAdmin: async (type, data) => {
                let embed = {};
                let contentMessage = "";

                if (type === 'application') {
                    contentMessage = "üî• ‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà!";
                    embed = {
                        title: "üìÑ ‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ (New Application)",
                        color: data.finalStatus === 'approved' ? 5763719 : 15548997, // Green : Red
                        fields: [
                            { name: "‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", value: data.fullName, inline: true },
                            { name: "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£", value: data.phone, inline: true },
                            { name: "‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠", value: formatCurrency(data.loanAmount), inline: true },
                            { name: "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ", value: formatCurrency(data.salary), inline: true },
                            { name: "‡∏≠‡∏≤‡∏ä‡∏µ‡∏û/‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤", value: `${data.loanWeeks} ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå`, inline: true },
                            { name: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ AI", value: data.finalStatus === 'approved' ? "‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥" : "‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥", inline: false },
                            { name: "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏", value: data.rejectReason || "-", inline: false }
                        ],
                        footer: { text: `Ref: ${data.refId} ‚Ä¢ IP: ${state.user?.uid || 'Guest'}` },
                        timestamp: new Date().toISOString()
                    };
                } else if (type === 'payment') {
                    contentMessage = "üí∞ ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤!";
                    embed = {
                        title: "slip ‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Payment)",
                        color: 3447003, // Blue
                        fields: [
                            { name: "‡∏ú‡∏π‡πâ‡∏ä‡∏≥‡∏£‡∏∞", value: data.fullName, inline: true },
                            { name: "‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô", value: formatCurrency(data.amount), inline: true },
                            { name: "Ref ID", value: data.refId, inline: true }
                        ],
                        timestamp: new Date().toISOString()
                    };
                }

                const body = {
                    username: "NantawatLoan Bot",
                    avatar_url: "https://cdn-icons-png.flaticon.com/512/4712/4712109.png",
                    content: contentMessage,
                    embeds: [embed]
                };

                // 2. Send to Discord
                // *** ‡πÉ‡∏™‡πà Link Discord Webhook ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ***
                const WEBHOOK_URL = 'https://discord.com/api/webhooks/1459799911527878687/YSo-OoqoVZ-HBfUoM8ynTPJcQELsERroBeoyxo4lltYMCvlWhZcP6q2Ch5U9QizE5GTN'; 

                console.log("--- DISCORD PAYLOAD ---", body);

                if (!WEBHOOK_URL) {
                    console.warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Discord Webhook URL (‡∏î‡∏π‡πÉ‡∏ô Console ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)");
                    return;
                }

                try {
                    await fetch(WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                    console.log("‚úÖ Sent to Discord successfully");
                } catch (err) {
                    console.error("‚ùå Error sending to Discord (‡∏≠‡∏≤‡∏à‡∏ï‡∏¥‡∏î CORS ‡∏´‡∏≤‡∏Å‡∏£‡∏±‡∏ô‡∏ö‡∏ô Browser):", err);
                }
            },

            // Handle Notify Payment (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô Modal)
            handlePaymentNotify: async () => {
                if (!state.applicationData) return;
                
                const btn = document.getElementById('btn-notify-payment');
                if(btn) {
                     btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô...';
                     btn.disabled = true;
                }

                // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                await app.notifyAdmin('payment', {
                    fullName: state.applicationData.fullName,
                    amount: state.applicationData.weeklyPayment,
                    refId: state.applicationData.refId
                });
                
                alert("‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô");
                app.closeModal();
            },

            // Form Submission
            handleApply: async (e) => {
                e.preventDefault();
                
                if (!state.user) return;

                const btn = document.getElementById('btn-submit');
                btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô...';
                btn.disabled = true;

                const formData = new FormData(e.target);
                const salary = Number(formData.get('salary'));
                const fullName = formData.get('fullName');
                const idCard = formData.get('idCard');
                const phone = formData.get('phone');

                // Logic Approve/Reject
                const maxLoan = salary * 5;
                const minSalaryReq = state.weeklyPayment * 2.5;
                let status = 'approved';
                let rejectReason = '';

                if (state.loanAmount > maxLoan) {
                    status = 'rejected';
                    rejectReason = '‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ';
                } else if (salary < minSalaryReq * 4) {
                    status = 'rejected';
                    rejectReason = '‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≠‡∏ô‡∏ä‡∏≥‡∏£‡∏∞';
                }

                // Handle Mocking if no DB
                if (!db) {
                    // Create mock Application Data
                    state.applicationData = {
                        fullName, idCard, phone, salary,
                        loanAmount: state.loanAmount,
                        loanWeeks: state.loanWeeks,
                        weeklyPayment: state.weeklyPayment,
                        status: 'pending',
                        finalStatus: status,
                        rejectReason,
                        createdAtDate: new Date(),
                        refId: `LD-${Math.floor(Math.random() * 1000000)}`
                    };

                    // Send Discord Notification (Mock Flow)
                    await app.notifyAdmin('application', state.applicationData);

                    // Redirect
                    setTimeout(() => {
                        app.router('dashboard');
                        btn.textContent = '‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£';
                        btn.disabled = false;
                        e.target.reset();
                    }, 1500);

                    return;
                }

                // Real Firebase Logic
                try {
                    await addDoc(collection(db, 'artifacts', appId, 'users', state.user.uid, 'applications'), {
                        fullName, idCard, phone, salary,
                        loanAmount: state.loanAmount,
                        loanWeeks: state.loanWeeks,
                        weeklyPayment: state.weeklyPayment,
                        status: 'pending',
                        finalStatus: status,
                        rejectReason,
                        createdAt: serverTimestamp(),
                        refId: `LD-${Math.floor(Math.random() * 1000000)}`
                    });

                    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (Updated)
                    await app.notifyAdmin('application', {
                        fullName,
                        loanAmount: state.loanAmount,
                        loanWeeks: state.loanWeeks,
                        phone,
                        salary,
                        finalStatus: status,
                        rejectReason
                    });

                    // Redirect to Dashboard with delay
                    setTimeout(() => {
                        app.router('dashboard');
                        btn.textContent = '‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£';
                        btn.disabled = false;
                        e.target.reset();
                    }, 1500);

                } catch (error) {
                    console.error("Error:", error);
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠");
                    btn.textContent = '‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£';
                    btn.disabled = false;
                }
            },

            // Dashboard Rendering
            renderDashboard: () => {
                const container = document.getElementById('dashboard-content');
                const data = state.applicationData;

                if (!data) {
                    container.innerHTML = `<div class="text-center text-slate-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>`;
                    return;
                }

                // Simulate Processing Delay logic
                const now = new Date();
                const created = data.createdAtDate || now;
                const diff = now - created;
                const shouldShowRealStatus = diff > 4000;

                const displayStatus = shouldShowRealStatus ? (data.finalStatus || data.status) : 'processing';

                // Re-render if waiting
                if (!shouldShowRealStatus) {
                   setTimeout(() => app.renderDashboard(), 4000 - diff);
                }

                if (displayStatus === 'processing' || displayStatus === 'pending') {
                    container.innerHTML = `
                        <div class="bg-slate-900 rounded-lg border border-slate-700 p-16 text-center shadow-xl">
                           <div class="w-24 h-24 relative mx-auto mb-8">
                              <div class="absolute inset-0 border-4 border-slate-700 rounded-full"></div>
                              <div class="absolute inset-0 border-t-4 border-cyan-500 rounded-full animate-spin"></div>
                              <div class="absolute inset-0 flex items-center justify-center">
                                <i data-lucide="server" class="h-10 w-10 text-cyan-500 animate-pulse"></i>
                              </div>
                           </div>
                           <h3 class="text-2xl font-bold text-white mb-2 uppercase tracking-wide animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</h3>
                           <p class="text-slate-400 font-mono text-sm">‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡∏ö‡∏π‡πÇ‡∏£‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô</p>
                        </div>
                    `;
                } else if (displayStatus === 'approved') {
                    container.innerHTML = `
                        <div class="space-y-6 animate-slide-up">
                          <div class="bg-slate-900 rounded-lg shadow-xl overflow-hidden border border-slate-700 relative group">
                            <div class="absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-green-400 to-emerald-600"></div>
                            <div class="absolute top-0 right-0 p-3">
                               <div class="flex items-center space-x-2 bg-slate-950/80 px-3 py-1 rounded-full text-[10px] text-green-400 border border-green-900 shadow-sm backdrop-blur-sm">
                                 <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                 <div class="flex items-center">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß (Approved)</div>
                               </div>
                            </div>
                            <div class="p-8">
                              <div class="flex justify-between items-start">
                                <div>
                                  <div class="flex items-center space-x-3 mb-3">
                                     <span class="text-slate-500 text-xs font-mono">ID: ${data.refId}</span>
                                  </div>
                                  <h3 class="text-4xl font-bold text-white mb-1 tracking-tight">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô</h3>
                                  <p class="text-slate-400 text-sm">‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</p>
                                </div>
                                <div class="bg-green-500/10 p-4 rounded-full border border-green-500/30">
                                  <i data-lucide="check-circle" class="h-8 w-8 text-green-400"></i>
                                </div>
                              </div>
                              <div class="mt-8 grid grid-cols-2 md:grid-cols-4 gap-6">
                                <div class="bg-slate-950/50 p-4 rounded border border-slate-800">
                                  <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô</p>
                                  <p class="text-lg font-bold text-white font-mono">${formatCurrency(data.loanAmount)}</p>
                                </div>
                                <div class="bg-slate-950/50 p-4 rounded border border-slate-800">
                                  <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">‡∏ú‡πà‡∏≠‡∏ô/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</p>
                                  <p class="text-lg font-bold text-cyan-400 font-mono">${formatCurrency(data.weeklyPayment)}</p>
                                </div>
                                <div class="bg-slate-950/50 p-4 rounded border border-slate-800">
                                  <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢</p>
                                  <p class="text-lg font-bold text-white font-mono">15%</p>
                                </div>
                                <div class="bg-slate-950/50 p-4 rounded border border-slate-800">
                                  <p class="text-[10px] text-slate-500 uppercase tracking-widest mb-1">‡πÄ‡∏ß‡∏•‡∏≤</p>
                                  <p class="text-lg font-bold text-white font-mono">${data.loanWeeks} ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</p>
                                </div>
                              </div>
                            </div>
                            <div class="bg-slate-950 px-8 py-4 border-t border-slate-800 flex justify-between items-center">
                              <span class="text-xs text-slate-500 font-mono">‡πÇ‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤: ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå ${data.phone}</span>
                              <button onclick="app.openModal('contract')" class="text-cyan-400 text-xs font-bold hover:text-cyan-300 uppercase tracking-wide flex items-center">
                                ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå <i data-lucide="chevron-right" class="w-3 h-3 ml-1"></i>
                              </button>
                            </div>
                          </div>
                          <!-- Payment Card -->
                          <div class="bg-gradient-to-r from-blue-900/40 to-slate-900 rounded-lg shadow-lg p-1 border border-blue-500/30">
                             <div class="bg-slate-900/50 rounded p-8 backdrop-blur-sm h-full">
                                <div class="flex justify-between items-center mb-6">
                                  <div>
                                    <h3 class="font-bold text-blue-300 text-sm uppercase tracking-widest mb-2">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏á‡∏ß‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</h3>
                                    <p class="text-3xl font-bold text-white font-mono">
                                        ${new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toLocaleDateString('th-TH')}
                                    </p>
                                  </div>
                                  <div class="p-3 bg-blue-500/10 rounded-full border border-blue-400/20">
                                    <i data-lucide="dollar-sign" class="h-8 w-8 text-blue-400"></i>
                                  </div>
                                </div>
                                <div class="flex space-x-4">
                                  <button onclick="app.openModal('payment')" class="bg-white text-slate-900 px-6 py-3 rounded font-bold hover:bg-cyan-50 transition shadow-lg uppercase text-sm tracking-wider">
                                    ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                                  </button>
                                </div>
                             </div>
                          </div>
                        </div>
                    `;
                } else {
                    container.innerHTML = `
                        <div class="bg-slate-900 rounded-lg border border-red-900/50 p-8 text-center shadow-xl animate-fade-in">
                           <div class="bg-red-500/10 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                               <i data-lucide="x" class="w-10 h-10 text-red-500"></i>
                           </div>
                           <h3 class="text-2xl font-bold text-white mb-2">‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h3>
                           <p class="text-slate-400 mb-6">${data.rejectReason || '‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå'}</p>
                           <button onclick="app.router('apply')" class="text-slate-500 hover:text-white underline text-sm">‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</button>
                        </div>
                    `;
                }
                lucide.createIcons();
            },

            // Dynamic Nav Buttons
            renderAuthButtons: () => {
                const desktopContainer = document.getElementById('auth-button-container');
                const mobileContainer = document.getElementById('mobile-auth-btn-container');
                
                let html = '';
                if (state.applicationData) {
                    html = `<button onclick="app.router('dashboard')" class="bg-slate-800 border border-green-500/50 text-green-400 px-4 py-2 rounded-lg font-medium flex items-center hover:bg-slate-700 transition-all shadow-[0_0_10px_rgba(34,197,94,0.2)]">
                              <i data-lucide="user" class="w-4 h-4 mr-2"></i> ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
                            </button>`;
                } else {
                    html = `<button onclick="app.router('apply')" class="bg-gradient-to-r from-cyan-600 to-blue-600 text-white px-6 py-2 rounded-lg font-bold hover:from-cyan-500 hover:to-blue-500 transition-all transform hover:scale-105 shadow-[0_0_15px_rgba(8,145,178,0.4)] border border-cyan-400/30">
                              ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠
                            </button>`;
                }

                desktopContainer.innerHTML = html;
                
                // Mobile version (full width)
                const mobileHtml = html.replace('bg-slate-800', 'block w-full text-left').replace('bg-gradient-to-r', 'block w-full text-left bg-gradient-to-r text-center');
                mobileContainer.innerHTML = mobileHtml;
                
                lucide.createIcons();
                
                // Highlight active nav
                const navHome = document.getElementById('nav-home');
                if (state.currentView === 'home') {
                    navHome.className = "text-cyan-400 drop-shadow-[0_0_5px_rgba(34,211,238,0.5)] font-medium tracking-wide transition-colors";
                } else {
                    navHome.className = "text-slate-400 hover:text-cyan-400 font-medium tracking-wide transition-colors";
                }
            },

            // Modals
            openModal: (type) => {
                const overlay = document.getElementById('modal-overlay');
                const title = document.getElementById('modal-title');
                const content = document.getElementById('modal-content');
                const iconContainer = document.getElementById('modal-icon');
                
                overlay.classList.remove('hidden');
                
                let iconName = 'info';
                if (type === 'products') {
                    title.textContent = '‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå';
                    iconName = 'banknote';
                    content.innerHTML = '<p>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• ‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏≤‡πÇ‡∏ô‡πÑ‡∏ü‡πÅ‡∏ô‡∏ô‡∏ã‡πå...</p>';
                } else if (type === 'help') {
                    title.textContent = '‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠';
                    iconName = 'info';
                    content.innerHTML = '<p>‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Support: 02-xxx-xxxx ‡∏´‡∏£‡∏∑‡∏≠ Line: @nantawatloan</p>';
                } else if (type === 'contract' && state.applicationData) {
                    title.textContent = '‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ';
                    iconName = 'file-check';
                    const d = state.applicationData;
                    content.innerHTML = `
                        <div class="bg-white text-black p-4 rounded text-xs font-mono h-64 overflow-y-auto">
                           <p class="font-bold mb-2 text-center">‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ‡∏≠‡∏¥‡πÄ‡∏•‡πá‡∏Å‡∏ó‡∏£‡∏≠‡∏ô‡∏¥‡∏Å‡∏™‡πå</p>
                           <p>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: ${d.refId}</p>
                           <p>‡∏ú‡∏π‡πâ‡∏Å‡∏π‡πâ: ${d.fullName}</p>
                           <p>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: ${formatCurrency(d.loanAmount)}</p>
                           <hr class="my-2"/>
                           <p class="text-justify">‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡∏Å‡∏π‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö NantawatLoan...</p>
                        </div>
                    `;
                } else if (type === 'payment' && state.applicationData) {
                    title.textContent = '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô';
                    iconName = 'qr-code';
                    const amount = state.applicationData.weeklyPayment;
                    content.innerHTML = `
                        <div class="text-center bg-white p-6 rounded flex flex-col items-center">
                           <p class="text-slate-600 font-bold mb-2 text-sm">‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</p>
                           <div class="bg-white p-2 rounded border border-slate-200 shadow-inner mb-4">
                              <img src="https://promptpay.io/0927105691/${amount}.png" alt="PromptPay QR" class="w-48 h-48 object-contain" />
                           </div>
                           <div class="w-full border-t border-slate-200 pt-3">
                              <p class="text-slate-500 text-xs mb-1">‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</p>
                              <p class="text-cyan-600 font-bold text-2xl">${formatCurrency(amount)}</p>
                              <p class="text-slate-400 text-[10px] mt-2 font-mono">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô: ‡∏ö‡∏à‡∏Å. ‡∏ô‡∏±‡∏ô‡∏ó‡∏ß‡∏±‡∏í‡∏ô‡πå‡πÇ‡∏•‡∏ô</p>
                           </div>
                           <button id="btn-notify-payment" onclick="app.handlePaymentNotify()" class="w-full mt-4 bg-blue-600 text-white py-2 rounded font-bold hover:bg-blue-500 transition shadow-lg text-sm flex items-center justify-center">
                               <i data-lucide="bell" class="w-4 h-4 mr-2"></i> ‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß
                           </button>
                        </div>
                    `;
                }

                iconContainer.innerHTML = `<i data-lucide="${iconName}" class="w-6 h-6"></i>`;
                lucide.createIcons();
            },

            closeModal: () => {
                document.getElementById('modal-overlay').classList.add('hidden');
            }
        };

        // Start App
        app.init();
    </script>
</body>
</html>